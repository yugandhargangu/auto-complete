!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common/http"),require("rxjs/operators"),require("@angular/forms"),require("@angular/common")):"function"==typeof define&&define.amd?define("@ngui/auto-complete",["exports","@angular/core","@angular/common/http","rxjs/operators","@angular/forms","@angular/common"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).ngui=t.ngui||{},t.ngui["auto-complete"]={}),t.ng.core,t.ng.common.http,t.rxjs.operators,t.ng.forms,t.ng.common)}(this,(function(t,e,n,o,r,i){"use strict";var s=function(){function t(t){this.http=t}return t.prototype.filter=function(t,e,n,o){var r=this;return o?t.filter((function(t){var o=n?r.getFormattedListItem(t).toLowerCase():JSON.stringify(t).toLowerCase();return e=e.toLowerCase(),-1!==o.normalize("NFD").replace(/[\u0300-\u036f]/g,"").indexOf(e.normalize("NFD").replace(/[\u0300-\u036f]/g,""))})):t.filter((function(t){var o=n?r.getFormattedListItem(t).toLowerCase():JSON.stringify(t).toLowerCase();return e=e.toLowerCase(),-1!==o.indexOf(e)}))},t.prototype.getFormattedListItem=function(t){var e,n=this.listFormatter||"(id) value";if("function"==typeof n)e=n.apply(this,[t]);else if("object"!=typeof t)e=t;else if("string"==typeof n){e=n;var o=n.match(/[a-zA-Z0-9_\$]+/g);o&&"string"!=typeof t&&o.forEach((function(n){e=e.replace(n,t[n])}))}return e},t.prototype.getRemoteData=function(t){var e=this;if("string"!=typeof this.source)throw new TypeError("Invalid type of source, must be a string. e.g. http://www.google.com?q=:my_keyword");if(!this.http)throw new Error("Http is required.");var n=this.source.match(/:[a-zA-Z_]+/);if(null===n)throw new Error("Replacement word is missing.");var r=n[0],i=this.source.replace(r,t);return this.http.get(i).pipe(o.map((function(t){e.pathToData&&e.pathToData.split(".").forEach((function(e){return t=t[e]}));return t})))},t}();s.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new s(e.ɵɵinject(n.HttpClient,8))},token:s,providedIn:"root"}),s.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],s.ctorParameters=function(){return[{type:n.HttpClient,decorators:[{type:e.Optional}]}]};var a=function(){function t(t,n){var o,r=this;this.autoComplete=n,this.autocomplete=!1,this.minChars=0,this.acceptUserInput=!0,this.loadingText="Loading",this.loadingTemplate=null,this.showInputTag=!0,this.showDropdownOnInit=!1,this.tabToSelect=!0,this.matchFormatted=!1,this.autoSelectFirstItem=!1,this.selectOnBlur=!1,this.reFocusAfterSelect=!0,this.headerItemTemplate=null,this.ignoreAccents=!0,this.valueSelected=new e.EventEmitter,this.customSelected=new e.EventEmitter,this.textEntered=new e.EventEmitter,this.dropdownVisible=!1,this.isLoading=!1,this.filteredList=[],this.minCharsEntered=!1,this.itemIndex=null,this.timer=0,this.delay=(o=null,function(t,e){clearTimeout(o),o=setTimeout(t,e)}),this.selectOnEnter=!1,this.reloadListInDelay=function(t){var e=r.isSrcArr()?10:500,n=t.target.value;r.delay((function(){return r.reloadList(n)}),e)},this.inputElKeyHandler=function(t){var e=r.filteredList.length;switch(!r.selectOnEnter&&r.autoSelectFirstItem&&0!==e&&(r.selectOnEnter=!0),t.keyCode){case 27:r.selectOnEnter=!1,r.selectOne(void 0);break;case 38:if(0===e)return;r.selectOnEnter=!0,r.itemIndex=(e+r.itemIndex-1)%e,r.scrollToView(r.itemIndex);break;case 40:if(0===e)return;r.selectOnEnter=!0,r.dropdownVisible=!0;var n=r.itemIndex;n=null===r.itemIndex?0:n+1,r.itemIndex=(e+n)%e,r.scrollToView(r.itemIndex);break;case 13:r.selectOnEnter&&r.selectOne(r.filteredList[r.itemIndex]),t.preventDefault();break;case 9:r.tabToSelect&&r.selectOne(r.filteredList[r.itemIndex])}},this.el=t.nativeElement}return t.prototype.ngOnInit=function(){var t=this;this.autoComplete.source=this.source,this.autoComplete.pathToData=this.pathToData,this.autoComplete.listFormatter=this.listFormatter,this.autoSelectFirstItem&&(this.itemIndex=0),setTimeout((function(){t.autoCompleteInput&&t.reFocusAfterSelect&&t.autoCompleteInput.nativeElement.focus(),t.showDropdownOnInit&&t.showDropdownList({target:{value:""}})}))},t.prototype.isSrcArr=function(){return Array.isArray(this.source)},t.prototype.showDropdownList=function(t){this.dropdownVisible=!0,this.reloadList(t.target.value)},t.prototype.hideDropdownList=function(){this.selectOnEnter=!1,this.dropdownVisible=!1},t.prototype.findItemFromSelectValue=function(t){var e=this.filteredList.filter((function(e){return""+e===t}));return e.length?e[0]:null},t.prototype.reloadList=function(t){var e=this;this.filteredList=[],t.length<(this.minChars||0)?this.minCharsEntered=!1:(this.minCharsEntered=!0,this.isSrcArr()?(this.isLoading=!1,this.filteredList=this.autoComplete.filter(this.source,t,this.matchFormatted,this.ignoreAccents),this.maxNumList&&(this.filteredList=this.filteredList.slice(0,this.maxNumList))):(this.isLoading=!0,"function"==typeof this.source?this.source(t).subscribe((function(t){e.pathToData&&e.pathToData.split(".").forEach((function(e){return t=t[e]}));e.filteredList=t,e.maxNumList&&(e.filteredList=e.filteredList.slice(0,e.maxNumList))}),(function(t){return null}),(function(){return e.isLoading=!1})):this.autoComplete.getRemoteData(t).subscribe((function(t){e.filteredList=t||[],e.maxNumList&&(e.filteredList=e.filteredList.slice(0,e.maxNumList))}),(function(t){return null}),(function(){return e.isLoading=!1}))))},t.prototype.selectOne=function(t){t||""===t?this.valueSelected.emit(t):this.customSelected.emit(this.keyword)},t.prototype.enterText=function(t){this.textEntered.emit(t)},t.prototype.blurHandler=function(t){this.selectOnBlur&&this.selectOne(this.filteredList[this.itemIndex]),this.hideDropdownList()},t.prototype.scrollToView=function(t){var e=this.autoCompleteContainer.nativeElement.querySelector("ul"),n=e.querySelector("li").offsetHeight,o=e.scrollTop,r=o+e.offsetHeight,i=n*t;(i<o||i+n>r)&&(e.scrollTop=i)},t.prototype.trackByIndex=function(t,e){return t},Object.defineProperty(t.prototype,"emptyList",{get:function(){return!(this.isLoading||this.minCharsEntered&&!this.isLoading&&!this.filteredList.length||this.filteredList.length)},enumerable:!1,configurable:!0}),t}();a.decorators=[{type:e.Component,args:[{selector:"ngui-auto-complete",template:'\n    <div #autoCompleteContainer class="ngui-auto-complete">\n      \x3c!-- keyword input --\x3e\n      <input *ngIf="showInputTag"\n             #autoCompleteInput class="keyword"\n             [attr.autocomplete]="autocomplete ? \'null\' : \'off\'"\n             placeholder="{{placeholder}}"\n             (focus)="showDropdownList($event)"\n             (blur)="blurHandler($event)"\n             (keydown)="inputElKeyHandler($event)"\n             (input)="reloadListInDelay($event)"\n             [(ngModel)]="keyword"/>\n\n      \x3c!-- dropdown that user can select --\x3e\n      <ul *ngIf="dropdownVisible" [class.empty]="emptyList">\n        <li *ngIf="isLoading && loadingTemplate" class="loading"\n            [innerHTML]="loadingTemplate"></li>\n        <li *ngIf="isLoading && !loadingTemplate" class="loading">{{loadingText}}</li>\n        <li *ngIf="minCharsEntered && !isLoading && !filteredList.length"\n            (mousedown)="selectOne(\'\')"\n            class="no-match-found">{{noMatchFoundText || \'No Result Found\'}}\n        </li>\n        <li *ngIf="headerItemTemplate && filteredList.length" class="header-item"\n            [innerHTML]="headerItemTemplate"></li>\n        <li *ngIf="blankOptionText && filteredList.length"\n            (mousedown)="selectOne(\'\')"\n            class="blank-item">{{blankOptionText}}\n        </li>\n        <li class="item"\n            *ngFor="let item of filteredList; let i=index; trackBy: trackByIndex"\n            (mousedown)="selectOne(item)"\n            [ngClass]="{selected: i === itemIndex}"\n            [innerHtml]="autoComplete.getFormattedListItem(item)">\n        </li>\n      </ul>\n\n    </div>\n  ',encapsulation:e.ViewEncapsulation.None,styles:["\n    @keyframes slideDown {\n      0% {\n        transform: translateY(-10px);\n      }\n      100% {\n        transform: translateY(0px);\n      }\n    }\n\n    .ngui-auto-complete {\n      background-color: transparent;\n    }\n\n    .ngui-auto-complete > input {\n      outline: none;\n      border: 0;\n      padding: 2px;\n      box-sizing: border-box;\n      background-clip: content-box;\n    }\n\n    .ngui-auto-complete > ul {\n      background-color: #fff;\n      margin: 0;\n      width: 100%;\n      overflow-y: auto;\n      list-style-type: none;\n      padding: 0;\n      border: 1px solid #ccc;\n      box-sizing: border-box;\n      animation: slideDown 0.1s;\n    }\n\n    .ngui-auto-complete > ul.empty {\n      display: none;\n    }\n\n    .ngui-auto-complete > ul li {\n      padding: 2px 5px;\n      border-bottom: 1px solid #eee;\n    }\n\n    .ngui-auto-complete > ul li.selected {\n      background-color: #ccc;\n    }\n\n    .ngui-auto-complete > ul li:last-child {\n      border-bottom: none;\n    }\n\n    .ngui-auto-complete > ul li:not(.header-item):hover {\n      background-color: #ccc;\n    }"]}]}],a.ctorParameters=function(){return[{type:e.ElementRef},{type:s}]},a.propDecorators={autocomplete:[{type:e.Input,args:["autocomplete"]}],listFormatter:[{type:e.Input,args:["list-formatter"]}],source:[{type:e.Input,args:["source"]}],pathToData:[{type:e.Input,args:["path-to-data"]}],minChars:[{type:e.Input,args:["min-chars"]}],placeholder:[{type:e.Input,args:["placeholder"]}],blankOptionText:[{type:e.Input,args:["blank-option-text"]}],noMatchFoundText:[{type:e.Input,args:["no-match-found-text"]}],acceptUserInput:[{type:e.Input,args:["accept-user-input"]}],loadingText:[{type:e.Input,args:["loading-text"]}],loadingTemplate:[{type:e.Input,args:["loading-template"]}],maxNumList:[{type:e.Input,args:["max-num-list"]}],showInputTag:[{type:e.Input,args:["show-input-tag"]}],showDropdownOnInit:[{type:e.Input,args:["show-dropdown-on-init"]}],tabToSelect:[{type:e.Input,args:["tab-to-select"]}],matchFormatted:[{type:e.Input,args:["match-formatted"]}],autoSelectFirstItem:[{type:e.Input,args:["auto-select-first-item"]}],selectOnBlur:[{type:e.Input,args:["select-on-blur"]}],reFocusAfterSelect:[{type:e.Input,args:["re-focus-after-select"]}],headerItemTemplate:[{type:e.Input,args:["header-item-template"]}],ignoreAccents:[{type:e.Input,args:["ignore-accents"]}],valueSelected:[{type:e.Output}],customSelected:[{type:e.Output}],textEntered:[{type:e.Output}],autoCompleteInput:[{type:e.ViewChild,args:["autoCompleteInput"]}],autoCompleteContainer:[{type:e.ViewChild,args:["autoCompleteContainer"]}]};var l=function(){function t(t,n,o){var r=this;this.resolver=t,this.viewContainerRef=n,this.parentForm=o,this.autocomplete=!1,this.acceptUserInput=!0,this.loadingTemplate=null,this.loadingText="Loading",this.tabToSelect=!0,this.selectOnBlur=!1,this.matchFormatted=!1,this.autoSelectFirstItem=!1,this.openOnFocus=!0,this.closeOnFocusOut=!0,this.reFocusAfterSelect=!0,this.headerItemTemplate=null,this.ignoreAccents=!0,this.zIndex="1",this.isRtl=!1,this.ngModelChange=new e.EventEmitter,this.valueChanged=new e.EventEmitter,this.customSelected=new e.EventEmitter,this.showAutoCompleteDropdown=function(t){if(!r.dropdownJustHidden){r.hideAutoCompleteDropdown(),r.scheduledBlurHandler=null;var e=r.resolver.resolveComponentFactory(a);r.componentRef=r.viewContainerRef.createComponent(e);var n=r.componentRef.instance;n.keyword=r.inputEl.value,n.showInputTag=!1,n.pathToData=r.pathToData,n.minChars=r.minChars,n.source=r.source,n.placeholder=r.autoCompletePlaceholder,n.acceptUserInput=r.acceptUserInput,n.maxNumList=parseInt(r.maxNumList,10),n.loadingText=r.loadingText,n.loadingTemplate=r.loadingTemplate,n.listFormatter=r.listFormatter,n.blankOptionText=r.blankOptionText,n.noMatchFoundText=r.noMatchFoundText,n.tabToSelect=r.tabToSelect,n.selectOnBlur=r.selectOnBlur,n.matchFormatted=r.matchFormatted,n.autoSelectFirstItem=r.autoSelectFirstItem,n.headerItemTemplate=r.headerItemTemplate,n.ignoreAccents=r.ignoreAccents,n.valueSelected.subscribe(r.selectNewValue),n.textEntered.subscribe(r.enterNewText),n.customSelected.subscribe(r.selectCustomValue),r.acDropdownEl=r.componentRef.location.nativeElement,r.acDropdownEl.style.display="none",r.inputEl.parentElement.insertBefore(r.acDropdownEl,r.inputEl.nextSibling),r.revertValue=void 0!==r.ngModel?r.ngModel:r.inputEl.value,setTimeout((function(){n.reloadList(r.inputEl.value),r.styleAutoCompleteDropdown(),n.dropdownVisible=!0}))}},this.hideAutoCompleteDropdown=function(t){if(r.componentRef){var e=void 0,n=void 0!==r.revertValue;r.inputEl&&n&&!1===r.acceptUserInput&&(e=r.componentRef.instance.findItemFromSelectValue(r.inputEl.value)),r.componentRef.destroy(),r.componentRef=void 0,r.inputEl&&n&&!1===r.acceptUserInput&&null===e?r.selectNewValue(r.revertValue):r.inputEl&&!0===r.acceptUserInput&&void 0===e&&t&&t.target.value&&r.enterNewText(t.target.value)}r.dropdownJustHidden=!0,setTimeout((function(){return r.dropdownJustHidden=!1}),100)},this.styleAutoCompleteDropdown=function(){if(r.componentRef){r.componentRef.instance,r.el.getBoundingClientRect();var t=r.inputEl.getBoundingClientRect(),e=t.bottom+100>window.innerHeight,n=r.isRtl?"right":"left";r.acDropdownEl.style.width=t.width+"px",r.acDropdownEl.style.position="absolute",r.acDropdownEl.style.zIndex=r.zIndex,r.acDropdownEl.style[n]="0",r.acDropdownEl.style.display="inline-block",e?r.acDropdownEl.style.bottom=t.height+"px":r.acDropdownEl.style.top=t.height+"px"}},this.selectNewValue=function(t){t&&"object"==typeof t&&(t=r.setToStringFunction(t)),r.renderValue(t);var e=t;r.selectValueOf&&t[r.selectValueOf]&&(e=t[r.selectValueOf]),(r.parentForm&&r.formControlName||r.extFormControl)&&e&&r.formControl.patchValue(e),e!==r.ngModel&&r.ngModelChange.emit(e),r.valueChanged.emit(e),r.hideAutoCompleteDropdown(),setTimeout((function(){return r.reFocusAfterSelect&&r.inputEl.focus(),r.inputEl}))},this.selectCustomValue=function(t){r.customSelected.emit(t),r.hideAutoCompleteDropdown(),setTimeout((function(){return r.reFocusAfterSelect&&r.inputEl.focus(),r.inputEl}))},this.enterNewText=function(t){r.renderValue(t),r.ngModelChange.emit(t),r.valueChanged.emit(t),r.hideAutoCompleteDropdown()},this.keydownEventHandler=function(t){r.componentRef&&r.componentRef.instance.inputElKeyHandler(t)},this.inputEventHandler=function(t){if(r.componentRef){var e=r.componentRef.instance;e.dropdownVisible=!0,e.keyword=t.target.value,e.reloadListInDelay(t)}else r.showAutoCompleteDropdown()},this.el=this.viewContainerRef.element.nativeElement}return t.prototype.ngOnInit=function(){var t=this;this.documentClickListener=function(e){t.scheduledBlurHandler&&(t.scheduledBlurHandler(),t.scheduledBlurHandler=null)},document.addEventListener("click",this.documentClickListener),this.wrapperEl=document.createElement("div"),this.wrapperEl.className="ngui-auto-complete-wrapper",this.wrapperEl.style.position="relative",this.el.parentElement.insertBefore(this.wrapperEl,this.el.nextSibling),this.wrapperEl.appendChild(this.el),this.parentForm&&this.formControlName?this.parentForm.form?this.formControl=this.parentForm.form.get(this.formControlName):this.parentForm instanceof r.FormGroupName&&(this.formControl=this.parentForm.control.controls[this.formControlName]):this.extFormControl&&(this.formControl=this.extFormControl),this.ngModel?this.selectNewValue(this.ngModel):this.formControl&&this.formControl.value&&this.selectNewValue(this.formControl.value)},t.prototype.ngAfterViewInit=function(){var t=this;this.inputEl="INPUT"===this.el.tagName?this.el:this.el.querySelector("input"),this.openOnFocus&&this.inputEl.addEventListener("focus",(function(e){return t.showAutoCompleteDropdown(e)})),this.closeOnFocusOut&&this.inputEl.addEventListener("focusout",(function(e){return t.hideAutoCompleteDropdown(e)})),this.autocomplete||this.inputEl.setAttribute("autocomplete","off"),this.inputEl.addEventListener("blur",(function(e){t.scheduledBlurHandler=function(){return t.blurHandler(e)}})),this.inputEl.addEventListener("keydown",(function(e){return t.keydownEventHandler(e)})),this.inputEl.addEventListener("input",(function(e){return t.inputEventHandler(e)}))},t.prototype.ngOnDestroy=function(){this.componentRef&&(this.componentRef.instance.valueSelected.unsubscribe(),this.componentRef.instance.textEntered.unsubscribe()),this.documentClickListener&&document.removeEventListener("click",this.documentClickListener)},t.prototype.ngOnChanges=function(t){t.ngModel&&(this.ngModel=this.setToStringFunction(t.ngModel.currentValue),this.renderValue(this.ngModel))},t.prototype.blurHandler=function(t){if(this.componentRef){var e=this.componentRef.instance;this.selectOnBlur&&e.selectOne(e.filteredList[e.itemIndex]),this.closeOnFocusOut&&this.hideAutoCompleteDropdown(t)}},t.prototype.setToStringFunction=function(t){if(t&&"object"==typeof t){var e;if("string"==typeof this.valueFormatter){var n=this.valueFormatter.match(/[a-zA-Z0-9_\$]+/g),o=this.valueFormatter;n&&"string"!=typeof t&&n.forEach((function(e){o=o.replace(e,t[e])})),e=o}else e="function"==typeof this.valueFormatter?this.valueFormatter(t):this.displayPropertyName?t[this.displayPropertyName]:"string"==typeof this.listFormatter&&this.listFormatter.match(/^\w+$/)?t[this.listFormatter]:t.value;t.toString=function(){return e}}return t},t.prototype.renderValue=function(t){this.inputEl&&(this.inputEl.value=""+t)},t}();l.decorators=[{type:e.Directive,args:[{selector:"[auto-complete], [ngui-auto-complete]"}]}],l.ctorParameters=function(){return[{type:e.ComponentFactoryResolver},{type:e.ViewContainerRef},{type:r.ControlContainer,decorators:[{type:e.Optional},{type:e.Host},{type:e.SkipSelf}]}]},l.propDecorators={autocomplete:[{type:e.Input,args:["autocomplete"]}],autoCompletePlaceholder:[{type:e.Input,args:["auto-complete-placeholder"]}],source:[{type:e.Input,args:["source"]}],pathToData:[{type:e.Input,args:["path-to-data"]}],minChars:[{type:e.Input,args:["min-chars"]}],displayPropertyName:[{type:e.Input,args:["display-property-name"]}],acceptUserInput:[{type:e.Input,args:["accept-user-input"]}],maxNumList:[{type:e.Input,args:["max-num-list"]}],selectValueOf:[{type:e.Input,args:["select-value-of"]}],loadingTemplate:[{type:e.Input,args:["loading-template"]}],listFormatter:[{type:e.Input,args:["list-formatter"]}],loadingText:[{type:e.Input,args:["loading-text"]}],blankOptionText:[{type:e.Input,args:["blank-option-text"]}],noMatchFoundText:[{type:e.Input,args:["no-match-found-text"]}],valueFormatter:[{type:e.Input,args:["value-formatter"]}],tabToSelect:[{type:e.Input,args:["tab-to-select"]}],selectOnBlur:[{type:e.Input,args:["select-on-blur"]}],matchFormatted:[{type:e.Input,args:["match-formatted"]}],autoSelectFirstItem:[{type:e.Input,args:["auto-select-first-item"]}],openOnFocus:[{type:e.Input,args:["open-on-focus"]}],closeOnFocusOut:[{type:e.Input,args:["close-on-focusout"]}],reFocusAfterSelect:[{type:e.Input,args:["re-focus-after-select"]}],headerItemTemplate:[{type:e.Input,args:["header-item-template"]}],ignoreAccents:[{type:e.Input,args:["ignore-accents"]}],ngModel:[{type:e.Input}],formControlName:[{type:e.Input,args:["formControlName"]}],extFormControl:[{type:e.Input,args:["formControl"]}],zIndex:[{type:e.Input,args:["z-index"]}],isRtl:[{type:e.Input,args:["is-rtl"]}],ngModelChange:[{type:e.Output}],valueChanged:[{type:e.Output}],customSelected:[{type:e.Output}]};var u=function(){};u.decorators=[{type:e.NgModule,args:[{declarations:[a,l],imports:[i.CommonModule,r.FormsModule],exports:[a,l]}]}],t.NguiAutoComplete=s,t.NguiAutoCompleteComponent=a,t.NguiAutoCompleteDirective=l,t.NguiAutoCompleteModule=u,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ngui-auto-complete.umd.min.js.map